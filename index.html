<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="theme-color" content="#2563eb" />
  <title>LÃDER MARKET - Sistema de Control de Inventario</title>

  <style>
    /* ====== RESET / BASE ====== */
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#2563eb;--primary-700:#1d4ed8;--success:#059669;--danger:#dc2626;--muted:#6b7280;
      --bg:#f3f4f6;--card:#fff;--blue-50:#eff6ff;--shadow:0 1px 3px rgba(0,0,0,.1)
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
      background:var(--bg);color:#111827;min-height:100vh;-webkit-font-smoothing:antialiased;overflow-x:hidden
    }
    .header{background:var(--primary);color:#fff;padding:.75rem}
    .container{max-width:1200px;margin:0 auto;padding:.75rem}
    .card{background:var(--card);border-radius:.75rem;padding:1.25rem;margin-bottom:.75rem;box-shadow:var(--shadow)}
    .btn{padding:.6rem 1.25rem;border:0;border-radius:.5rem;font-weight:700;cursor:pointer;transition:.2s;display:inline-block;text-align:center}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:var(--primary-700)}
    .btn-success{background:var(--success);color:#fff}.btn-danger{background:var(--danger);color:#fff}
    .btn-gray{background:#6b7280;color:#fff}
    .btn-gold{background:#f59e0b;color:#fff}
    .btn-whatsapp{background:#25D366;color:#fff}.btn-whatsapp:hover{background:#128C7E;transform:translateY(-2px);box-shadow:0 4px 12px rgba(37,211,102,.4)}
    .input{width:100%;padding:.5rem;border:2px solid #d1d5db;border-radius:.5rem;font-size:.95rem;text-align:center}
    .input:focus{outline:none;border-color:var(--primary);background:var(--blue-50)}
    .input:disabled{opacity:.6;background:#eee}
    .flex{display:flex;gap:1rem;align-items:center}.flex-wrap{flex-wrap:wrap}.flex-col{flex-direction:column}
    .justify-between{justify-content:space-between}.justify-center{justify-content:center}.text-center{text-align:center}
    .hidden{display:none !important}
    .grid{display:grid;gap:1rem}.grid-2{grid-template-columns:1fr 1fr}
    .badge{padding:.2rem .6rem;border-radius:9999px;font-size:.7rem;font-weight:700;white-space:nowrap}
    .badge-blue{background:#dbeafe;color:#1e40af}.badge-green{background:#dcfce7;color:#166534}.badge-yellow{background:#fef3c7;color:#92400e}
    .badge-zero{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca}
    .supplier-card{color:#fff;border-radius:1rem;padding:1rem;cursor:pointer;transition:.2s;margin-bottom:.75rem}
    .supplier-card:hover{transform:translateY(-2px)}.supplier-card:active{transform:scale(.98)}
    .product-card{border-left:4px solid #d1d5db}.product-card.counted{border-left-color:var(--success)}
    .product-card.zero-max{background:rgba(220,38,38,.06);border-left-color:rgba(220,38,38,.8)}
    .count-input{font-size:2rem;font-weight:800;max-width:110px;background:#fef3c7;border:3px solid #f59e0b;text-align:center;border-radius:.5rem}
    .count-input:focus{background:#fef9c3;border-color:#d97706}
    .count-button{width:3rem;height:3rem;border-radius:.75rem;border:0;font-size:1.5rem;font-weight:800;cursor:pointer;transition:.2s}
    .count-button.plus{background:var(--success);color:#fff}.count-button.minus{background:var(--danger);color:#fff}
    .fixed-bottom{position:fixed;left:0;right:0;bottom:0;background:#fff;padding:.5rem .75rem;border-top:1px solid #d1d5db;box-shadow:0 -4px 6px rgba(0,0,0,.1);z-index:10}
    .progress-info{background:#dbeafe;color:#1e40af;padding:.5rem;border-radius:.5rem;margin-bottom:.75rem;font-size:.85rem}
    .step-counter{font-weight:800;font-size:.9rem;color:#374151;margin-bottom:.35rem;text-align:center}
    .results-card{background:#fff;border-radius:.75rem;padding:0;margin-bottom:.75rem;border-left:4px solid var(--primary);box-shadow:var(--shadow);overflow:hidden}
    .results-header{cursor:pointer;transition:.2s;padding:1rem;border-bottom:1px solid #e5e7eb}
    .results-header:hover{background:#f8fafc}.results-card.expanded .results-header{background:#f0f9ff}
    .results-content{padding:1rem;border-top:1px solid #e5e7eb;background:#f9fafb}
    .expand-icon{transition:.2s;font-size:1rem;color:#6b7280;font-weight:700;display:inline-block}
    .expand-icon.rotated{transform:rotate(180deg);color:var(--success)}
    .results-product{padding:.5rem;border-radius:.5rem;margin-bottom:.5rem;border-left:3px solid #d1d5db}
    .results-product.has-count{background:#f0fdf4;border-left-color:var(--success)}
    .results-product.no-count{background:#fefce8;border-left-color:#eab308}
    .results-product.zero-max{background:rgba(220,38,38,.06);border-left-color:rgba(220,38,38,.8)}
    .order-summary{background:#f8fafc;border:2px solid #e2e8f0;border-radius:.75rem;padding:.75rem;margin-top:.75rem}
    .order-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border-bottom:1px solid #e2e8f0}
    .order-item:last-child{border-bottom:none}
    .order-total{background:var(--primary);color:#fff;padding:.5rem;border-radius:.5rem;font-weight:700;text-align:center;margin-top:.5rem}
    .admin-header{background:#f59e0b}
    .import-stats{background:#f0fdf4;border:2px solid #bbf7d0;border-radius:.5rem;padding:1rem;margin-bottom:1rem}
    .import-error{background:#fef2f2;border:2px solid #fecaca;border-radius:.5rem;padding:1rem;margin-bottom:1rem;color:var(--danger)}
    .preview-table{width:100%;border-collapse:collapse;margin-top:1rem;font-size:.875rem}
    .preview-table th,.preview-table td{border:1px solid #d1d5db;padding:.5rem;text-align:left}
    .preview-table th{background:#f3f4f6;position:sticky;top:0;z-index:5}
    .row-zero{background:rgba(220,38,38,.06)}
    /* Calendar */
    .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem}
    .day-col{background:#f8fafc;border:1px solid #e5e7eb;border-radius:.5rem;padding:.5rem}
    .day-title{font-weight:800;margin-bottom:.25rem}
    .pill{border-radius:9999px;padding:.35rem .6rem;display:inline-block;margin:.2rem 0;cursor:pointer;user-select:none;transition:transform .1s}
    .pill:hover{transform:translateY(-2px)}
    .pill.visited{background:#fee2e2 !important;color:#b91c1c !important;text-decoration:line-through}
    .pill.disabled{opacity:.65;cursor:default}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50;padding:.75rem}
    .modal.show{display:flex}
    .modal-box{background:#fff;border-radius:.75rem;max-width:420px;width:100%;box-shadow:var(--shadow);overflow:hidden}
    .modal-header{padding:1rem;background:#1e293b;color:#fff;font-weight:800}
    .modal-body{padding:1rem}
    .modal-actions{display:flex;gap:.5rem;justify-content:flex-end;padding:0 1rem 1rem}
    /* Mobile */
    @media(max-width:768px){
      .container{padding:.5rem}.card{padding:.75rem;margin-bottom:.5rem}.flex{gap:.5rem}
      .grid-2{grid-template-columns:1fr}.count-input{max-width:80px;font-size:1.6rem}
      .count-button{width:2.6rem;height:2.6rem}.preview-table{font-size:.75rem}
      h1,h2{font-size:1.1rem !important}
    }
    /* Print */
    @media print{.btn,.fixed-bottom{display:none !important} body{background:#fff} .card{box-shadow:none;break-inside:avoid}}
    /* PWA update UI */
    #app-update-controller{position:fixed;right:14px;bottom:14px;z-index:99999;display:none}
    #app-update-controller button{padding:10px 14px;border:none;border-radius:10px;box-shadow:0 6px 16px rgba(0,0,0,.2);font-weight:600;background:#2563eb;color:#fff;cursor:pointer}
    #app-update-toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:10px;display:none;z-index:99999}
  </style>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>

<body>
  <div id="app">
    <!-- ====== LOGIN ====== -->
    <div id="loginScreen">
      <div class="header">
        <h1 style="font-size:1.5rem;margin-bottom:.25rem">LÃDER MARKET</h1>
        <p style="font-size:.875rem">Sistema de Control de Inventario</p>
      </div>
      <div class="container">
        <div class="card" style="max-width:420px;margin:2rem auto">
          <h2 class="text-center" style="margin-bottom:1rem">Iniciar SesiÃ³n</h2>
          <div class="flex" style="margin-bottom:1rem;background:#f3f4f6;border-radius:.5rem;padding:.25rem">
            <button id="userTab" class="btn" style="flex:1;background:var(--primary);color:#fff">Usuario</button>
            <button id="adminTab" class="btn" style="flex:1;background:transparent;color:var(--muted)">Admin</button>
          </div>
          <input id="username" class="input" placeholder="Ingrese su nombre" autocomplete="off" style="margin-bottom:1rem" />
          <div id="passwordField" class="hidden" style="margin-bottom:1rem">
            <input id="password" class="input" type="password" placeholder="Ingrese la contraseÃ±a de administrador" autocomplete="off" />
          </div>
          <button id="loginBtn" class="btn btn-primary" style="width:100%">Ingresar</button>
        </div>
      </div>
    </div>

    <!-- ====== USER DASHBOARD ====== -->
    <div id="userDashboard" class="hidden">
      <div class="header">
        <div class="flex justify-between">
          <div>
            <h1 style="font-size:1.25rem;margin-bottom:.1rem">LÃDER MARKET</h1>
            <p id="welcomeUser" style="font-size:.875rem">Hola, Usuario</p>
          </div>
          <button id="logoutBtn" class="btn" style="background:rgba(255,255,255,.2);padding:.5rem 1rem;font-size:.875rem">Salir</button>
        </div>
      </div>

      <div class="container">
        <!-- Calendario visible para USUARIO -->
        <div class="card">
          <h3 style="margin-bottom:.5rem">ğŸ—“ï¸ Calendario de Visitas</h3>
          <p style="font-size:.8rem;color:#6b7280;margin-bottom:.5rem">Toca un proveedor para contar o (si es el dÃ­a) para <strong>confirmar que ya vino</strong>.</p>
          <div id="calendarGridUser" class="calendar-grid">
            <div class="day-col" data-day="1"><div class="day-title">Lunes</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="2"><div class="day-title">Martes</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="3"><div class="day-title">MiÃ©rcoles</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="4"><div class="day-title">Jueves</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="5"><div class="day-title">Viernes</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="6"><div class="day-title">SÃ¡bado</div><div class="day-slot"></div></div>
            <div class="day-col" data-day="0"><div class="day-title">Domingo</div><div class="day-slot"></div></div>
          </div>
        </div>

        <div id="todayCard" class="card" style="display:none">
          <div class="flex justify-between">
            <h3>ğŸ“Œ Proveedores de hoy</h3>
            <button id="clearVisitedToday" class="btn btn-gray" style="padding:.3rem .6rem;font-size:.8rem">Limpiar marcas de hoy</button>
          </div>
          <div id="todaySuppliers" class="flex flex-wrap" style="margin-top:.5rem"></div>
        </div>

        <div class="flex" style="margin:.75rem 0;background:#f3f4f6;border-radius:.75rem;padding:.25rem">
          <button id="countingTab" class="btn" style="flex:1;background:var(--primary);color:#fff;margin:0">ğŸ“¦ Conteo</button>
          <button id="resultsTab" class="btn" style="flex:1;background:transparent;color:var(--muted);margin:0">ğŸ“Š Resultados</button>
        </div>

        <div id="countingSection">
          <h2 style="margin-bottom:.75rem">Seleccionar Proveedor</h2>
          <div id="suppliersList"></div>
        </div>

        <div id="resultsSection" class="hidden">
          <h2 style="margin-bottom:.75rem">Resultados de Conteos</h2>
          <div id="resultsContainer"></div>
        </div>
      </div>
    </div>

    <!-- ====== ADMIN DASHBOARD ====== -->
    <div id="adminDashboard" class="hidden">
      <div class="header admin-header">
        <div class="flex justify-between">
          <div>
            <h1 style="font-size:1.25rem;margin-bottom:.1rem">LÃDER MARKET - ADMIN</h1>
            <p style="font-size:.875rem">Panel de AdministraciÃ³n</p>
          </div>
          <button id="adminLogoutBtn" class="btn" style="background:rgba(255,255,255,.2);padding:.5rem 1rem;font-size:.875rem">Salir</button>
        </div>
      </div>

      <div class="container">
        <div class="card">
          <h2 style="margin-bottom:.75rem">ğŸ“‹ ImportaciÃ³n de Productos</h2>
          <div style="background:#dbeafe;padding:.75rem;border-radius:.5rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.25rem;color:#1e40af;font-size:.95rem">ğŸ“ Formato requerido (6 columnas):</h3>
            <div style="font-family:monospace;font-size:.8rem;line-height:1.3;background:#fff;padding:.5rem;border-radius:.25rem;margin:.25rem 0">
              <strong>A:</strong> Proveedor | <strong>B:</strong> Producto | <strong>C:</strong> Max Stock | <strong>D:</strong> CÃ³digo | <strong>E:</strong> Unidades/Paq | <strong>F:</strong> Tipo
            </div>
            <div style="background:#059669;color:#fff;padding:.375rem .5rem;border-radius:.25rem;font-size:.8rem">
              ğŸ’¡ <strong>Ejemplo:</strong> Coca-Cola â€” Coca Cola 600ml â€” 240 â€” 7501055365050 â€” 24 â€” PAQUETE
            </div>
          </div>

          <textarea id="importData" class="input" style="min-height:150px;font-family:monospace;font-size:.8rem;text-align:left"
            placeholder="Pega aquÃ­ los datos copiados desde Excel/Google Sheets..."></textarea>

          <div class="flex" style="gap:1rem;margin-top:.75rem">
            <button id="previewBtn" class="btn btn-primary" style="flex:1">ğŸ‘ï¸ Vista Previa</button>
            <button id="saveBtn" class="btn btn-success" style="flex:1" disabled>ğŸ’¾ Guardar</button>
            <button id="clearBtn" class="btn btn-danger">ğŸ—‘ï¸ Limpiar</button>
          </div>

          <button id="loadExampleBtn" class="btn btn-success" style="margin-top:.75rem;width:100%">âš¡ Cargar Datos de Prueba</button>
          <div id="previewContainer" class="hidden" style="margin-top:1rem"></div>
        </div>

        <div class="card">
          <h2 style="margin-bottom:.75rem">âš™ï¸ GestiÃ³n de Datos</h2>
          <div id="managementInfo" style="background:#f8fafc;padding:.75rem;border-radius:.5rem;margin-bottom:.75rem">
            <div class="flex justify-between" style="margin-bottom:.25rem">
              <span><strong>Proveedores:</strong> <span id="supplierCount">0</span></span>
              <span><strong>Productos:</strong> <span id="productCount">0</span></span>
            </div>
          </div>

          <div style="background:#e0f2fe;border:2px solid #0284c7;border-radius:.75rem;padding:.75rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.5rem;color:#0c4a6e;font-size:.95rem">ğŸ¢ GestiÃ³n Manual de Proveedores y Productos</h3>
            <div class="flex" style="margin-bottom:.75rem;background:#f3f4f6;border-radius:.5rem;padding:.25rem">
              <button id="manageSuppliersTab" class="btn" style="flex:1;background:#0284c7;color:#fff;margin:0">ğŸ¢ Proveedores</button>
              <button id="manageProductsTab" class="btn" style="flex:1;background:transparent;color:var(--muted);margin:0">ğŸ“¦ Productos</button>
            </div>

            <!-- Suppliers -->
            <div id="manageSuppliersSection">
              <div style="margin-bottom:.75rem">
                <h4 style="font-weight:600;margin-bottom:.375rem;font-size:.9rem">â• Agregar Nuevo Proveedor</h4>
                <div class="grid grid-2" style="gap:.5rem;margin-bottom:.5rem">
                  <input id="newSupplierName" class="input" placeholder="Nombre del proveedor" style="text-align:left" />
                  <select id="newSupplierType" class="input" style="text-align:left">
                    <option value="individual">ğŸ”¸ Individual</option>
                    <option value="package">ğŸ“¦ Paquete</option>
                    <option value="mixto">ğŸ”„ Mixto</option>
                  </select>
                </div>
                <button id="addSupplierBtn" class="btn btn-success" style="width:100%">â• Agregar Proveedor</button>
              </div>

              <div style="margin-top:1rem">
                <h4 style="font-weight:600;margin-bottom:.375rem;font-size:.9rem">ğŸ“‹ Proveedores Existentes</h4>
                <div id="suppliersListAdmin" style="max-height:250px;overflow-y:auto"></div>
              </div>
            </div>

            <!-- Products -->
            <div id="manageProductsSection" class="hidden">
              <div style="margin-bottom:.75rem">
                <h4 style="font-weight:600;margin-bottom:.375rem;font-size:.9rem">â• Agregar Nuevo Producto</h4>
                <select id="productSupplierSelect" class="input" style="text-align:left;margin-bottom:.5rem">
                  <option value="">Seleccionar proveedor...</option>
                </select>
                <input id="newProductName" class="input" placeholder="Nombre del producto" style="text-align:left;margin-bottom:.5rem" />
                <div class="grid grid-2" style="gap:.5rem;margin-bottom:.5rem">
                  <input id="newProductMaxStock" class="input" type="number" min="0" placeholder="Max Stock (0 permitido)" style="text-align:left" />
                  <input id="newProductBarcode" class="input" placeholder="CÃ³digo de barras" style="text-align:left" />
                </div>
                <div class="grid grid-2" style="gap:.5rem;margin-bottom:.5rem">
                  <select id="newProductType" class="input" style="text-align:left">
                    <option value="individual">ğŸ”¸ Individual</option>
                    <option value="package">ğŸ“¦ Paquete</option>
                  </select>
                  <input id="newProductPackageSize" class="input" type="number" min="1" value="1" placeholder="Unidades/Paquete" style="text-align:left" />
                </div>
                <button id="addProductBtn" class="btn btn-success" style="width:100%">â• Agregar Producto</button>
              </div>

              <div style="margin-top:1rem">
                <h4 style="font-weight:600;margin-bottom:.375rem;font-size:.9rem">ğŸ“‹ Productos por Proveedor</h4>
                <select id="viewProductsSupplier" class="input" style="text-align:left;margin-bottom:.5rem">
                  <option value="">Seleccionar proveedor...</option>
                </select>
                <div id="productsListAdmin" style="max-height:250px;overflow-y:auto"></div>
              </div>
            </div>
          </div>

          <!-- Seguridad -->
          <div style="background:#fef2f2;border:2px solid #fecaca;border-radius:.75rem;padding:.75rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.5rem;color:#dc2626;font-size:.95rem">ğŸ” ConfiguraciÃ³n de Seguridad</h3>
            <div class="grid grid-2" style="gap:.5rem;margin-bottom:.5rem">
              <input id="currentPassword" class="input" type="password" placeholder="ContraseÃ±a actual" style="text-align:left" />
              <input id="newPassword" class="input" type="password" placeholder="Nueva contraseÃ±a" style="text-align:left" />
            </div>
            <input id="confirmPassword" class="input" type="password" placeholder="Confirmar nueva contraseÃ±a" style="text-align:left;margin-bottom:.5rem" />
            <button id="changePasswordBtn" class="btn" style="width:100%;background:#dc2626;color:#fff">ğŸ” Cambiar ContraseÃ±a</button>
          </div>

          <!-- Nube (Firebase) -->
          <div style="background:#ecfeff;border:2px solid #06b6d4;border-radius:.75rem;padding:.75rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.5rem;color:#0e7490;font-size:.95rem">â˜ï¸ SincronizaciÃ³n en Equipo (Firebase)</h3>
            <p style="font-size:.8rem;color:#0e7490;margin-bottom:.5rem">Opcional. Si no configuras, la app funciona 100% local.</p>
            <input id="teamIdInput" class="input" placeholder="TEAM_ID (ej: LIDER-MARKET-TEAM-ABC123)" style="text-align:left;margin-bottom:.5rem" />
            <textarea id="firebaseConfigInput" class="input" style="min-height:80px;font-family:monospace;font-size:.8rem;text-align:left;margin-bottom:.5rem"
              placeholder='Pega aquÃ­ tu JSON de Firebase, por ejemplo:
{
  "apiKey": "...",
  "authDomain": "...",
  "projectId": "...",
  "appId": "..."
}'></textarea>
            <div class="flex" style="gap:.5rem">
              <button id="cloudEnableBtn" class="btn btn-success" style="flex:1">âœ… Activar sincronizaciÃ³n</button>
              <button id="cloudTestBtn" class="btn btn-gold">ğŸ§ª Probar</button>
              <button id="cloudDisableBtn" class="btn btn-danger">â›” Desactivar</button>
            </div>
            <div id="cloudStatus" style="margin-top:.5rem;font-size:.85rem;color:#0e7490">Estado: SincronizaciÃ³n desactivada</div>
          </div>

          <!-- Compartir / Exportar -->
          <div style="background:#dbeafe;border:2px solid #3b82f6;border-radius:.75rem;padding:.75rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.5rem;color:#1e40af;font-size:.95rem">ğŸ“¤ Compartir Sistema Cargado</h3>
            <p style="font-size:.8rem;color:#1e40af;margin-bottom:.75rem">Exporta la aplicaciÃ³n completa (sin contraseÃ±a).</p>
            <div class="grid grid-2" style="gap:.5rem">
              <button id="exportSystemBtn" class="btn btn-primary">ğŸ“± Compartir por WhatsApp</button>
              <button id="exportEmailBtn" class="btn btn-success">ğŸ“§ Enviar por Email</button>
              <button id="downloadSystemBtn" class="btn btn-gray">ğŸ’¾ Descargar Archivo</button>
              <button id="copySystemBtn" class="btn btn-gold">ğŸ“‹ Copiar Datos</button>
            </div>
          </div>

          <!-- Importar -->
          <div style="background:#f0fdf4;border:2px solid #bbf7d0;border-radius:.75rem;padding:.75rem;margin-bottom:.75rem">
            <h3 style="font-weight:600;margin-bottom:.5rem;color:#059669;font-size:.95rem">ğŸ“¥ Importar Sistema Completo</h3>
            <textarea id="importSystemData" class="input" style="min-height:80px;font-family:monospace;font-size:.8rem;text-align:left;margin-bottom:.5rem"
              placeholder="Pega aquÃ­ los datos del sistema exportado..."></textarea>
            <button id="importSystemBtn" class="btn btn-success" style="width:100%">ğŸ“¥ Importar Sistema</button>
          </div>

          <!-- Calendario (ADMIN) -->
          <div class="card" style="padding:0;margin-bottom:.75rem">
            <div style="padding:1rem">
              <h2 style="margin-bottom:.5rem">ğŸ—“ï¸ Calendario de Visitas (admin)</h2>
              <div id="calendarGridAdmin" class="calendar-grid">
                <div class="day-col" data-day="1"><div class="day-title">Lunes</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="2"><div class="day-title">Martes</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="3"><div class="day-title">MiÃ©rcoles</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="4"><div class="day-title">Jueves</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="5"><div class="day-title">Viernes</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="6"><div class="day-title">SÃ¡bado</div><div class="day-slot"></div></div>
                <div class="day-col" data-day="0"><div class="day-title">Domingo</div><div class="day-slot"></div></div>
              </div>
              <div class="flex" style="margin-top:.75rem">
                <select id="calSupplier" class="input" style="text-align:left">
                  <option value="">Seleccionar proveedorâ€¦</option>
                </select>
                <select id="calDay" class="input" style="text-align:left">
                  <option value="">DÃ­aâ€¦</option>
                  <option value="1">Lunes</option><option value="2">Martes</option><option value="3">MiÃ©rcoles</option>
                  <option value="4">Jueves</option><option value="5">Viernes</option><option value="6">SÃ¡bado</option><option value="0">Domingo</option>
                </select>
                <button id="calAdd" class="btn btn-success">â• Agendar</button>
                <button id="calClearDay" class="btn btn-danger">ğŸ—‘ï¸ Limpiar DÃ­a</button>
              </div>
            </div>
          </div>

          <button id="clearAllBtn" class="btn btn-danger" style="width:100%">ğŸ—‘ï¸ Limpiar Todos los Datos</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL de confirmaciÃ³n de visita -->
  <div id="confirmModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modal-box">
      <div id="confirmTitle" class="modal-header">Confirmar visita</div>
      <div class="modal-body">
        <div id="confirmText" style="line-height:1.4"></div>
      </div>
      <div class="modal-actions">
        <button id="confirmCancel" class="btn btn-gray">Cancelar</button>
        <button id="confirmToggle" class="btn btn-danger">Marcar como visitado</button>
      </div>
    </div>
  </div>

  <!-- PWA: registra el Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
  </script>

  <!-- UI botÃ³n de actualizaciÃ³n PWA -->
  <div id="app-update-controller"><button id="btn-force-update">Actualizar app</button></div>
  <div id="app-update-toast">ActualizaciÃ³n lista. Reinicia la app.</div>

  <!-- ===== ORDEN DE SCRIPTS ===== -->
  <!-- 1) ConfiguraciÃ³n en la nube (debe ir ANTES del app principal) -->
  <script src="./cloud-config.js?v=1"></script>

  <!-- 2) Gestos/forzar actualizaciÃ³n PWA -->
  <script src="./gesture-update.js"></script>

  <!-- 3) LÃ³gica principal de la app -->
  <script src="./admin-slim.v2.js?v=6"></script>

  <!-- 4) Fixes opcionales del calendario -->
  <script src="./calendar-week-fix.js?v=2"></script>
  <script src="./calendar-scroll-fix.js?v=1"></script>
</body>
</html>
